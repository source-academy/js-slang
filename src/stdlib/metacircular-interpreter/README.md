# JediScript Meta-Circular Evaluator
####_vastly more up-to-date instructions, in nice Markdown format._

This project comprises 4 main components:

1. The parser, written in Jison
2. The interpreter, written in legal JediScript
3. The scratch project templates, which are a combination of JediScript, JavaScript, and Markup-JS (a templating engine)
4. The project generator (`generate.js`)

These all work together to form the functional evaluator.

## Setting up the environment
1. This project depends on node.js. Install [node.js](http://nodejs.org) for your platform.
2. Using the shell for your platform, run `envsetup.{sh|bat}`. This will obtain the necessary installation dependencies and generate the development versions of the templates.
   - Note that your Jison install will be patched to throw SyntaxError exceptions when parse errors occur. This may affect your other Jison dependents, if any.
2 (alternative) . Just run `npm install` and all the dependencies should be magically installed.  
3. If you have made changes to the templates, generate new development libraries by running `generate.js --environment`.
4. `scratch.html` in the root directory of the project has got the evaluator-in-evaluator code being part of `test3`. Use that to test the interpreter interpreting itself.

## Generating Student Scratch Projects
In addition to generating the development libraries, the templates can be used in concert with the generator to produce scratch projects which only contain valid JediScript elements for any given week. Generate these by running `generate.js --week N`.

If you are modifying the templates, note that:

- When modifying the Jison template source, Jison blocks within Markup-JS blocks (i.e. Jison declarations within the `{{if}}` or other blocks) must have `$$` escaped to `$$$`. This is because Markup-JS will remove one `$`, leaving invalid Jison declarations
- If new user-defined functions must be provided to the student, update `export.js`. `export.js` contains a list of key-value pairs, which will be registered in the interpreter so the student can access them from his script file.
- By default, the generated scratch project will have the parser screen the input from the student's script tags and evaluate it. The student's code can still be directly evaluated by the browser's JavaScript engine by passing `--native` (`--no-native` will equivalently enable interpreted mode. But that's the default)
- The generator will send all output through to Google's Closure compiler, both to shrink the codebase and also to optimise the code. Passing `--debug` while generating the package will suppress this, so that the generator (or the libraries) can be debugged.

## Unit Testing
I've coded unit tests for the interpreter. Open `test.html`, the test suite will run automatically. This uses the parser and other libraries generated by `generate.js --environment`, so  be sure to run it before any testing.
